<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>–ú–∞—Ä–∫–µ—Ç</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    <style>
        :root {
            --green-light: #34d399;
            --green-main: #10b981;
            --green-dark: #059669;
        }

        .sidebar { 
            width: 250px; 
            height: 100vh; 
            background-color: #212529; 
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
        }
        .sidebar-icon { width: 18px; height: 18px; margin-right: 12px; }
        .main-content { 
            flex: 1; 
            padding: 20px 8px; 
            margin-left: 250px;
            height: 100vh;
            overflow-y: auto;
        }
        .text-shadow { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); }
        .card { transition: all 0.3s ease; }
        .card:hover { box-shadow: 0 8px 16px rgba(16, 185, 129, 0.2); }
        .card:hover .card-img-top { transform: scale(1.05); }
        .card-img-top[data-bs-toggle="modal"] { position: relative; }
        .card-img-top[data-bs-toggle="modal"]:hover::after { content: "üîç –ù–∞–∂–º–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è"; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap; }

        /* –ê–∫—Ç–∏–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-link-active {
            background: linear-gradient(135deg, var(--green-light) 0%, var(--green-main) 100%) !important;
            border: none !important;
        }

        .nav-link-inactive {
            background: transparent !important;
            border: none !important;
        }

        .nav-link-inactive:hover {
            background: rgba(52, 211, 153, 0.1) !important;
        }

        /* –û–¥–∏–Ω–∞–∫–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–æ–∫ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
        .card-body .btn-sm {
            min-width: 85px;
        }
    </style>
</head>
<body>
<div class="d-flex">
    <!-- Sidebar -->
    <div class="sidebar text-white d-flex flex-column">
        <!-- Header -->
        <div class="p-3 border-bottom border-secondary">
            <div class="d-flex align-items-center">
                <div class="rounded-circle d-flex align-items-center justify-content-center"
                     style="width: 32px; height: 32px; background: linear-gradient(135deg, #34d399 0%, #10b981 100%);">
                    <span class="fw-bold text-white">B</span>
                </div>
                <span class="ms-2 fs-5">–ú–µ–Ω—é</span>
            </div>
        </div>

        <!-- Main Navigation -->
        <nav class="flex-grow-1 p-2">
            <ul class="list-unstyled mb-0">
                <li class="mb-1">
                    <a href="{% url 'marketplace:products_list' %}" class="btn w-100 text-start d-flex align-items-center text-white text-decoration-none {% if request.resolver_match.url_name == 'products_list' %}nav-link-active{% else %}nav-link-inactive{% endif %}">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9,22 9,12 15,12 15,22"></polyline>
                        </svg>
                        <span>–ì–ª–∞–≤–Ω–∞—è</span>
                    </a>
                </li>
                <li class="mb-1">
                    <button class="btn w-100 text-start d-flex align-items-center text-white nav-link-inactive">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <polygon points="12,2 2,7 12,12 22,7 12,2"></polygon>
                            <polyline points="2,17 12,22 22,17"></polyline>
                            <polyline points="2,12 12,17 22,12"></polyline>
                        </svg>
                        <span>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                    </button>
                </li>
                <li class="mb-1">
                    <button class="btn w-100 text-start d-flex align-items-center text-white nav-link-inactive">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                            <line x1="3" x2="21" y1="6" y2="6"></line>
                            <path d="m16 10a4 4 0 0 1-8 0"></path>
                        </svg>
                        <span>–ó–∞–∫–∞–∑—ã</span>
                    </button>
                </li>
                <li class="mb-1">
                    <a href="{% url 'marketplace:contacts' %}" class="btn w-100 text-start d-flex align-items-center text-white text-decoration-none {% if request.resolver_match.url_name == 'contacts' %}nav-link-active{% else %}nav-link-inactive{% endif %}">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <span>–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                    </a>
                </li>
                <li class="mb-1">
                    <a href="{% url 'blog:post_list' %}" class="btn w-100 text-start d-flex align-items-center text-white text-decoration-none {% if 'blog' in request.path %}nav-link-active{% else %}nav-link-inactive{% endif %}">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        <span>–ë–ª–æ–≥</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- User Section -->
        <div class="p-2 border-top border-secondary">
            {% if user.is_authenticated %}
            <div class="dropdown">
                <button class="btn w-100 text-start d-flex align-items-center text-white nav-link-inactive dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span class="text-truncate">{{ user.email|truncatewords:2 }}</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark w-100" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="{% url 'users:profile' %}">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <form method="post" action="{% url 'users:logout' %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item">–í—ã—Ö–æ–¥</button>
                        </form>
                    </li>
                </ul>
            </div>
            {% else %}
            <ul class="list-unstyled mb-0">
                <li class="mb-1">
                    <button type="button" class="btn w-100 text-start d-flex align-items-center text-white text-decoration-none nav-link-inactive" data-bs-toggle="modal" data-bs-target="#loginModal">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" x2="3" y1="12" y2="12"></line>
                        </svg>
                        <span>–í—Ö–æ–¥</span>
                    </button>
                </li>
                <li class="mb-1">
                    <button type="button" class="btn w-100 text-start d-flex align-items-center text-white text-decoration-none nav-link-inactive" data-bs-toggle="modal" data-bs-target="#registerModal">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" x2="20" y1="8" y2="14"></line>
                            <line x1="23" x2="17" y1="11" y2="11"></line>
                        </svg>
                        <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                    </button>
                </li>
            </ul>
            {% endif %}
        </div>
    </div>
    <!-- Main Content -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #34d399 0%, #10b981 100%);">
                <h5 class="modal-title text-white" id="loginModalLabel">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if messages %}
                <div id="loginMessages">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                <form method="post" action="{% url 'users:login' %}">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.GET.next|default:'/' }}">

                    <div class="mb-3">
                        <label for="login_email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="login_email" name="username" placeholder="email@example.com" required autofocus>
                    </div>

                    <div class="mb-3">
                        <label for="login_password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="login_password" name="password" placeholder="********" required>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">–í–æ–π—Ç–∏</button>
                    </div>

                    <div class="text-center mt-3">
                        <p class="text-muted">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #34d399 0%, #10b981 100%);">
                <h5 class="modal-title text-white" id="registerModalLabel">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if messages %}
                <div id="registerMessages">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                <form method="post" action="{% url 'users:register' %}">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.GET.next|default:'/' }}">

                    <div class="mb-3">
                        <label for="register_email" class="form-label">Email *</label>
                        <input type="email" class="form-control" id="register_email" name="email" placeholder="email@example.com" required>
                    </div>

                    <div class="mb-3">
                        <label for="register_password1" class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                        <input type="password" class="form-control" id="register_password1" name="password1" placeholder="********" required>
                        <small class="form-text text-muted">–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</small>
                    </div>

                    <div class="mb-3">
                        <label for="register_password2" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è *</label>
                        <input type="password" class="form-control" id="register_password2" name="password2" placeholder="********" required>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </div>

                    <div class="text-center mt-3">
                        <p class="text-muted">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">–í–æ–π—Ç–∏</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="/static/js/bootstrap.bundle.min.js"></script>

<!-- Auto-open modal on error -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('show_login_modal')) {
        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
        loginModal.show();
    }
    if (urlParams.get('show_register_modal')) {
        const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
        registerModal.show();
    }
});
</script>

</body>
</html>